import numpy as np
from Crypto.Util.number import long_to_bytes
from math import gcd


def test1():
    """Pętla i sprawdzanie kwadratów"""
    p = 29
    for e in [14, 6, 11]:
        for i in range(1, p):
            if i * i % p == e:
                print(f'{i}^2mod{p} == {e}')


def ls(i, p):
    e = (p - 1) // 2 # musi być zaokrąglenie pomimo, że równe (?)
    return pow(i % p, e, p)


def test2():
    # https://www.rieselprime.de/ziki/Modular_square_root
    # https://math.stackexchange.com/questions/1273690/when-p-3-pmod-4-show-that-ap1-4-pmod-p-is-a-square-root-of-a
    p = 101524035174539890485408575671085261788758965189060164484385690801466167356667036677932998889725476582421738788500738738503134356158197247473850273565349249573867251280253564698939768700489401960767007716413932851838937641880157263936985954881657889497583485535527613578457628399173971810541670838543309159139

    ints = [
        25081841204695904475894082974192007718642931811040324543182130088804239047149283334700530600468528298920930150221871666297194395061462592781551275161695411167049544771049769000895119729307495913024360169904315078028798025169985966732789207320203861858234048872508633514498384390497048416012928086480326832803,
        45471765180330439060504647480621449634904192839383897212809808339619841633826534856109999027962620381874878086991125854247108359699799913776917227058286090426484548349388138935504299609200377899052716663351188664096302672712078508601311725863678223874157861163196340391008634419348573975841578359355931590555,
        17364140182001694956465593533200623738590196990236340894554145562517924989208719245429557645254953527658049246737589538280332010533027062477684237933221198639948938784244510469138826808187365678322547992099715229218615475923754896960363138890331502811292427146595752813297603265829581292183917027983351121325,
        14388109104985808487337749876058284426747816961971581447380608277949200244660381570568531129775053684256071819837294436069133592772543582735985855506250660938574234958754211349215293281645205354069970790155237033436065434572020652955666855773232074749487007626050323967496732359278657193580493324467258802863,
        4379499308310772821004090447650785095356643590411706358119239166662089428685562719233435615196994728767593223519226235062647670077854687031681041462632566890129595506430188602238753450337691441293042716909901692570971955078924699306873191983953501093343423248482960643055943413031768521782634679536276233318,
        85256449776780591202928235662805033201684571648990042997557084658000067050672130152734911919581661523957075992761662315262685030115255938352540032297113615687815976039390537716707854569980516690246592112936796917504034711418465442893323439490171095447109457355598873230115172636184525449905022174536414781771,
        50576597458517451578431293746926099486388286246142012476814190030935689430726042810458344828563913001012415702876199708216875020997112089693759638454900092580746638631062117961876611545851157613835724635005253792316142379239047654392970415343694657580353333217547079551304961116837545648785312490665576832987,
        96868738830341112368094632337476840272563704408573054404213766500407517251810212494515862176356916912627172280446141202661640191237336568731069327906100896178776245311689857997012187599140875912026589672629935267844696976980890380730867520071059572350667913710344648377601017758188404474812654737363275994871,
        4881261656846638800623549662943393234361061827128610120046315649707078244180313661063004390750821317096754282796876479695558644108492317407662131441224257537276274962372021273583478509416358764706098471849536036184924640593888902859441388472856822541452041181244337124767666161645827145408781917658423571721,
        18237936726367556664171427575475596460727369368246286138804284742124256700367133250078608537129877968287885457417957868580553371999414227484737603688992620953200143688061024092623556471053006464123205133894607923801371986027458274343737860395496260538663183193877539815179246700525865152165600985105257601565]

    g = None
    for i in ints:
        if ls(i, p) == 1: # jest quadratic residue
            g = i
            print(g)
            break
    print(g%4) # czy można użyć poniższych wzorów (o ile jest 3)
    x1 = pow(g, (p+1)//4, p)
    x2 = pow(g, (p+1)//4, -p)
    print(x1)
    print(x2)


def test3():
    # https://sagecell.sagemath.org/
    # https://doc.sagemath.org/html/en/reference/finite_rings/sage/rings/finite_rings/integer_mod.html
    """
    from sage.rings.finite_rings.integer_mod import square_root_mod_prime
    p = 30531851861994333252675935111487950694414332763909083514133769861350960895076504687261369815735742549428789138300843082086550059082835141454526618160634109969195486322015775943030060449557090064811940139431735209185996454739163555910726493597222646855506445602953689527405362207926990442391705014604777038685880527537489845359101552442292804398472642356609304810680731556542002301547846635101455995732584071355903010856718680732337369128498655255277003643669031694516851390505923416710601212618443109844041514942401969629158975457079026906304328749039997262960301209158175920051890620947063936347307238412281568760161

    a = Mod(
        8479994658316772151941616510097127087554541274812435112009425778595495359700244470400642403747058566807127814165396640215844192327900454116257979487432016769329970767046735091249898678088061634796559556704959846424131820416048436501387617211770124292793308079214153179977624440438616958575058361193975686620046439877308339989295604537867493683872778843921771307305602776398786978353866231661453376056771972069776398999013769588936194859344941268223184197231368887060609212875507518936172060702209557124430477137421847130682601666968691651447236917018634902407704797328509461854842432015009878011354022108661461024768,
        p)
    x = square_root_mod_prime(a, p)
    print(x)
    """


def test4():
    # https://medium.com/analytics-vidhya/chinese-remainder-theorem-using-python-25f051e391fc
    # Python 3.6
    from functools import reduce
    def chinese_remainder(m, a):
        sum = 0
        prod = reduce(lambda acc, b: acc * b, m)
        for m_i, a_i in zip(m, a):
            p = prod // m_i
            sum += a_i * mul_inv(p, m_i) * p
        return sum % prod

    def mul_inv(a, b):
        b0 = b
        x0, x1 = 0, 1
        if b == 1: return 1
        while a > 1:
            q = a // b
            a, b = b, a % b
            x0, x1 = x1 - q * x0, x0
        if x1 < 0: x1 += b0
        return x1
    m = [5, 11, 17] # 5*11*17=935
    a = [2, 3, 5]
    print(chinese_remainder(m, a))


def test5():
    v = np.array([2, 6, 3])
    w = np.array([1, 0, 0])
    u = np.array([7, 7, 2])
    print(3*(2*v-w).dot(2*u))


def test6():
    v = np.array([4, 6, 2, 5])
    print(np.sqrt(v.dot(v)))


def test7():
    # https://link-1springer-1com-1q12c56yg1f6a.eczyt.bg.pw.edu.pl/book/10.1007/978-0-387-77993-5
    v1 = np.array([4., 1., 3., -1.])
    v2 = np.array([2., 1., -3., 4.])
    v3 = np.array([1., 0., -2., 7.])
    v4 = np.array([6., 2., 9., -5.])
    V = [v1, v2, v3, v4]
    U = [v1]
    for i, v in enumerate(V):
        if i == 0:
            continue
        ui = v
        for j in range(0, i):
            ui -= v.dot(U[j])/(U[j].dot(U[j]))*U[j]
        U.append(ui)
    print(U)


def test8():
    # obj. to wyznacznik macierzy
    v1 = np.array([6, 2, -3])
    v2 = np.array([5, 1, 4])
    v3 = np.array([2, 7, 1])
    print(np.linalg.det(np.array([v1, v2, v3])))


def gau_red(v1, v2):
    # https://link-1springer-1com-1q12c56yg1f6a.eczyt.bg.pw.edu.pl/book/10.1007/978-0-387-77993-5
    while True:
        v1, v2 = (v2, v1) if v1.dot(v1) > v2.dot(v2) else (v1, v2)
        m = int(np.rint(v1.dot(v2) / v1.dot(v1)))
        if m == 0:
            break
        v2 = v2 - m * v1
    return v1, v2


def test9():
    v = np.array([846835985, 9834798552], dtype=np.int64) # ważny typ, bo domyślnie za mały
    u = np.array([87502093, 123094980], dtype=np.int64)
    v1 = v
    v2 = u
    v1, v2 = gau_red(v1, v2)
    print(v1.dot(v2))


def test10():
    # https://link-1springer-1com-1q12c56yg0935.eczyt.bg.pw.edu.pl/book/10.1007/978-0-387-77993-5
    """
    from Crypto.Util.number import getPrime, inverse, bytes_to_long
    import random
    import math

    FLAG = b'crypto{?????????????????????}'


    def gen_key():
        q = getPrime(512)
        upper_bound = int(math.sqrt(q // 2))
        lower_bound = int(math.sqrt(q // 4))
        f = random.randint(2, upper_bound)
        while True:
            g = random.randint(lower_bound, upper_bound)
            if math.gcd(f, g) == 1:
                break
        h = (inverse(f, q)*g) % q
        return (q, h), (f, g)


    def encrypt(q, h, m):
        assert m < int(math.sqrt(q // 2))
        r = random.randint(2, int(math.sqrt(q // 2)))
        e = (r*h + m) % q
        return e


    def decrypt(q, h, f, g, e):
        a = (f*e) % q
        m = (a*inverse(f, g)) % g
        return m


    public, private = gen_key()
    q, h = public
    f, g = private

    m = bytes_to_long(FLAG)
    e = encrypt(q, h, m)

    print(f'Public key: {(q,h)}')
    print(f'Encrypted Flag: {e}')
    """

    """
    f * h == g mod q ( bo h = (inverse(f, q)*g) % q )
    f, g nie takie duże
    q, h - duże
    
    f * 1 - r * 0 = f
    f * h - r * q = g
    
    f * (1, h) - r * (0, q) = (f, g)
    
    """
    public_key = (
        7638232120454925879231554234011842347641017888219021175304217358715878636183252433454896490677496516149889316745664606749499241420160898019203925115292257,
        2163268902194560093843693572170199707501787797497998463462129592239973581462651622978282637513865274199374452805292639586264791317439029535926401109074800
    )
    encrypted_flag = \
        5605696495253720664142881956908624307570671858477482119657436163663663844731169035682344974286379049123733356009125671924280312532755241162267269123486523

    q, h = public_key
    f, g = gau_red(np.array([1, h]), np.array([0, q]))
    print(f) # SVP (f, g)
    print(g)

    def decrypt(q, h, f, g, e):
        from Crypto.Util.number import inverse
        a = (f*e) % q
        m = (a*inverse(f, g)) % g
        return m

    m = decrypt(q, h, f[0], f[1], encrypted_flag)
    print(m)
    print(long_to_bytes(m).decode())


def test11():
    # Znów ta książka... ale nie działa metoda 1 ... a1; 0 1 ... a2; ... ; 0 0 ... -s (?)
    # Działa z 1/2 zamiast 0 i 1!
    """
    import random
    from collections import namedtuple
    import gmpy2
    from Crypto.Util.number import isPrime, bytes_to_long, inverse, long_to_bytes

    FLAG = b'crypto{??????????????????????????}'
    PrivateKey = namedtuple("PrivateKey", ['b', 'r', 'q'])

    def gen_private_key(size):
        s = 10000
        b = []
        for _ in range(size):
            ai = random.randint(s + 1, 2 * s)
            assert ai > sum(b)
            b.append(ai)
            s += ai
        while True:
            q = random.randint(2 * s, 32 * s)
            if isPrime(q):
                break
        r = random.randint(s, q)
        assert q > sum(b)
        assert gmpy2.gcd(q,r) == 1
        return PrivateKey(b, r, q)


    def gen_public_key(private_key: PrivateKey):
        a = []
        for x in private_key.b:
            a.append((private_key.r * x) % private_key.q)
        return a


    def encrypt(msg, public_key):
        assert len(msg) * 8 <= len(public_key)
        ct = 0
        msg = bytes_to_long(msg)
        for bi in public_key:
            ct += (msg & 1) * bi
            msg >>= 1
        return ct


    def decrypt(ct, private_key: PrivateKey):
        ct = inverse(private_key.r, private_key.q) * ct % private_key.q
        msg = 0
        for i in range(len(private_key.b) - 1, -1, -1):
             if ct >= private_key.b[i]:
                 msg |= 1 << i
                 ct -= private_key.b[i]
        return long_to_bytes(msg)


    private_key = gen_private_key(len(FLAG) * 8)
    public_key = gen_public_key(private_key)
    encrypted = encrypt(FLAG, public_key)
    decrypted = decrypt(encrypted, private_key)
    assert decrypted == FLAG

    print(f'Public key: {public_key}')
    print(f'Encrypted Flag: {encrypted}')

    """
    # Ciąg superrosnący!
    # Prywatny klucz ma b - kolejne liczby z których składa się potem szyfrogam wedle bitów.
    # Szyfrogram to suma i jednoznacznie powinno dać się określić, z jakich składa się liczb (bo kolejne są większe
    # od dotychczasowej sumy.
    public_key = [
        260288377891444370372615148009023640057294926547602419331406531383682223097787288755377467188515435381259752760746,
        322734358011758862401399370931929863052553602421714393280581187496537763321855751120439457234561080720455397490349,
        88092359256403564783665281993130133541226601877969436905267415353041909757324746080398461245281826552421872983184,
        601684701300110945921036937572461050140352984401874675917155063594305583314408001377505387079690115000992094388032,
        193814643850628739958152744041743058858484088269609293429408490294552345005365776962194365813796130165113184925621,
        51510606914703888409341761261103125433754505248101513818740574350196563260563818621033222936301769697693287778876,
        502702742677974540308798846750017003106263447846689040491266463798703222616320168069962523670400796196343460832764,
        86989835783586738140883150201327374176124588410464188692884973334241681514702306716383785095564084499563152815246,
        515511378187957676256419959601984383408150348796281656976955880729383340611785836962788715725367023923811376366815,
        119845178983025037005174732553931706284024826223176718982111213579707091766057320315419827781508690979405126062061,
        207867794910968434026003881920029657224591376925067493713968219177352819759854486838459675245909787840416982457750,
        239399986603216503029402544900610984881160101923294396792665204486222975420081300661354603175384772323551980155480,
        306665236132315336961576566094908486196981556971172170145299174389720334940261512384837950321772782983903454058725,
        558130280550827068212352576387713811027468233905173944680355562037815257403446113128895937326412940859588204361963,
        123471925832174980344066571541132411467266736109103860421447462536930482316849470378251137263190870093702164003085,
        146089706629012142384661350988216882483919264673129621404831339166566056469572087759748854086023354002641923689390,
        446097892684389219719742914373867457099954499449824602532333181169038249081395758983133906564840000962001976506057,
        204029934276059225352901134714823317920576872465404508059719045291560482057171052793698580294637069578017200124432,
        412333373143000457741307988470055504576675151299345387733692618218275177027643785881042018546460452418506341967356,
        171418413940299360322712423004114364681865276057786947919043883366302567169869592290151559269290446563185553350080,
        401593473337411114258578268223784182795068785564101722335215736591292301602077751376477881087346810602041717163104,
        204003688543820354337113938494979311981574571424756883928855286926734578790400322291262042466654212377708831289347,
        555612926496986208337317871061684502803594375654879680702581403987248292734014139717756900004905653768133795128973,
        462785612281910846822645629160953231999037081137615204334672445418078665808070086646804794186256411131615189487813,
        77961961618173276050791733447969083544152711482614563228085622136316525792569658878271751219358260960116292497570,
        517789370221435419776588087490678991824021927945387533283088388790482913301281733115458601414668206432512998904516,
        281870328340314395150658482932699114581743200279996227099530744754750289102031518563761975024621347281374162044877,
        60204977937304337797770029325498234132893935850995809547662640467737007197647697381430963693698522962733473746281,
        395936787836195675178388359277761575381601972138693830435288611414489963379399027975388601714741876831895709497105,
        90921357930302550361827901642067284191268695594120415817202534786924330392421221829361546010764453051928814876700,
        238523907687908075601117120608130752369082206676107364350347208286323115036939777325067473364465438898353765093766,
        277515010021988996116595000889051160811249034599876556819610707794016612800585201793339332495839495779526504613846,
        187215937497318890199135284983515062319988136636108170852591598862524363777870331888216170582220867500042557737272,
        411220029331367081136918789112083235781237730079305782620378994961505282090962448446931628731751970521853108685376,
        433613620456520979627974441205441942311133790647897226320388205340695256818608765746266662314499649013982035729731,
        509613591091334719216567967380183602959933686617275815879939870258332674755345348802452058256788513837941126219238,
        352708166022264045150842358964512080203788453464883319778517822047480718640858804837886057264514786742694419419735,
        486272357335492500753956372299255798603575392697018451800774427752724312455328655650777691830508441976819499348269,
        1291533249748053824342851185451970324561531056195308125673915619130780992270420765078102812914222570167615953050,
        520707501920546816250915326019351261090208813534492143136485743644939372232638461802625700978801768541842624647274,
        272359456788721692618768612190222453304838934916628492701462591276450281926223118982602858211688086607842351391495,
        119534191144397164327417397593964021477488683311215644770010641745736480039094209273092223959694752862193314087240,
        394945131470603614379767959704654538029557537489316246092982427107641617479545488843535929537498546432123287486437,
        395979428475608101765230328218274625986674115712051764903732593018454264017781340199795540039285257513438842708672,
        322101629493887220159199019582810892418957941946300752245249462093036697035162212557261470168522953435341905295650,
        60610073299031334532969727880668989046838926047395613981473675505442500833244137863225398782029541439420403686372,
        492582431835005621441922899995666806499437611069193099072247918597047415020628078410849119945608854080040163699375,
        356290614124448077864884136922409291617128370298210212357882465167338600485728936925448944675136056707929560080237,
        469737185578879122378016959759297464132272432425745272107998534197014940235018335349886398896979254122985841196030,
        522871107234918024128768136315123497251902274681110489386594944387181296826024289163431880961506314580935567743910,
        407151723612481391724375429193917289623669496278028982297086458062111012958436324350527302865535766565677711383191,
        597354385774970715448797740483856119139152021834911852144490298736330354118482480147237280491305029710326837274157,
        541106433608213985607913120402276000940203625086988929757276286018099336445558864548353610869729642196223750468493,
        417269959280528548156948994397262973057821055108288565091113745409730174626359955737489143948177504667498654245449,
        165844467199853002181647516786815801413939363188955720855463610698066730208657222822269457713666541555820608908443,
        54875733171006797537647859403084623422036246809497621662400918381496284440644503330411668895858884933248328986102,
        465819050441857934210906305127374377291850450707906416261994960542649394393702032587209990932960399224341143990297,
        369322923825463715724411404444452360125845865658673947242361968271863944079047696087621731311243573179527276498509,
        553158781749591211954659671173145767949897795287325677938373702443265138456771264711232588438786042792968904732769,
        409812013938165700887519758386718364160025926340003407045361393371862966914817952304595560620453598830906305966865,
        494654868138757552768371639418237489264099471894419220273147503624077564865563661914136003656825657044284503346448,
        583613295252460993144403074130901622751986348055784728175987246652496523293580989652454868505577305787293683850652,
        45623098408168398769971239387495928980835555721564847009059790575158770295430426790200773274288087331109699336204,
        39196430635656777174378129146834600960125068266405306877726260536750371354188413207203531511343645151492477471286,
        269811462520469960288594953357779332541515563494806499705455036716689694055741096626927182558039773813984145657639,
        56129158162087034209035841739296133948708529713411817898928727109770418208078239244331640522507423413446203417794,
        524210107239750288249530336771864024916995632570549267972428294539507299820629133801771958736839361325798918246415,
        74499040113803277306263886217659673645883223840279171192334357737741618882160648968176974754905084576184804774369,
        537566085689080717108870646705458338163437075433046077845999622035879463636776663759447985884960181167857417860517,
        67053890181708018909161683393261532526993578729770554741021482840348299866927821016301415949708659944497709907470,
        226687291544149270579995169198961617407190234578516732237756117257869929434434889879973211444301745820066870869034,
        30119130560797352224094299766590747178156378314088092947830899847927767559391822485618397327733723834195435500170,
        273554685078063587415670757725663508130498751998110442807136494763920302805098071555958936900406570453984774374060,
        87980277743580170573607118853300224477595233902389343863665172738347967268089655736029345194767280704236057718111,
        415325115863346791298232938393411393462777451386243842830553121689594926353646948497680883539360608323603975987452,
        291860381996369849963997875749710331697722876276851205203280910491894467229365951220031470367159168511107680106262,
        554653569462940342418063467925252548314485118886100002832290030505991378878498660088540140703141291011055029173137,
        323189774384600834625013268084915768916855209746568551595158521873406091567687194674213765428238599317205811518692,
        271805885895959097314720980134407607645324820417975238169874050425279962478579515969226563851125481000349196674810,
        273580504244152469063405670227951980303621824057876058884978331188257821496852334599050020207990127348359965113465,
        89994080154200685717636930068317931325931168723237899144166312528962957042842197915530047017893088501681215899095,
        179903529806043505032581494908566846659773117049401056767669943330229935007822437549131470977810261112485254094386,
        337553339737054880017288314951575451797426862530219763936855885416298554494199226261714888518914541341927073075939,
        55576723594346882914517616915509260915444308762551400560217462518909289055446940809390878002725822401595827206530,
        16748220768196858904499918524709172735166549515085689048938405549141121222201553686060172878474455615920723669801,
        317380564633191615800168658676142557493413060315417096622564923156521630376263849705099633192226251101432134441153,
        533990888376667129575141849433166253104032964155895368357797314378260092470904627861359175864364684662961150582207,
        51339665999563119517609216115086272052501396280925354694804471629521639434841281422984348587180771099209184749005,
        598751671521816401429095343374521592165563401213195481604556405443389323390172923217639290327197434030974530635632,
        502516418942980462174586089858060912235797554801782186782319843655355616321036648106166017773986280053024012403712,
        96757697084956246010025820107260538706827163135748809142998937362457169471061108292297066769079020843197361323396,
        160715027762704553320571142674023737670353756130518440136900430091151963142004047232920245715827837173811719927140,
        279138292123840748082780689543574043699162822819208361733228093396335579794292477744981338016264347327181324984710,
        76445842054689324523514421681098261857514827631364695255959418519245612571199123499205752729124353901548286671941,
        383675319414133753635121914615218464358220814208747712016103562476157464944897131756675168140846189629485664787044,
        260741648290568813857849033448155840373964568801980310694295413631289231242930901519918814851819352903132884286000,
        572815144956474380133620797676157654285774633299428534205241845335783095326631133195133798583360396067031309578073,
        326258465939147178368353573060965288327891986807699582822092415027094204965326681853802159504539722937811913340954,
        270266570242986488258809014590807152136633692716132669770748395523214017062557603428657196661342410476403164567952,
        594635668324174018778140793057815156885870465660609865234586849536688338135131804764199647040009222634146148815637,
        112066852946512058163194024984815176069074331367673763590415760757313750687675218022751871678411881684718198988959,
        72643140251973593561700085821570131390914743121754868577502110904091989089708201436984242838820806097191225214858,
        418558767829526524235103555737958351573183096833081038769308995724925326439890724874671213539641031754157727776067,
        196559288823369030489094238610617412012659194878611686482089456487889879135369906410569754176462601644487717691079,
        484475844260869041475828428835126624027291693283800645559775410528136122290210564467730445814182429120097372738911,
        397895531572254423225385975618860549078025992059379971480526615942245245283818149065605766495091059477544617632303,
        173098235745543952336517747078283517802667869630628062474315240281111485771833849083340162673485620557610425012773,
        395438744730241817782361196255681827924847041028664896503460681041226871979986416514203189980456170013127549062319,
        470021990867207717347003710359490169212637212255796418181420825247262094876084196634243149241752002339736588912053,
        116393009019558569654503508922282193810180596603376432764270301486325221610807518426481578453602546466299515294456,
        312679236344738874814229979243462639486594453393064312671149009880980836289564409215088541509970023077739205203468,
        125633612607015147027292740679836345332097512816636698981581758992992116056276272361001165705597842757882238693825,
        550545747650576990464265884382499274254872311986381675090751886824037811235625095205217845451891396561893492715391,
        582344947379262203945082609921047126789902458640974947174265099323728700596079597139164883619347159500887293859913,
        597445807393853093495564866081359122814348105478914638258595339515168987499771664924728981250079847198831836930965,
        203086100710322798737771097067197649738932976573837729229038404179992238381339090779534246758253939763462200026384,
        366083021996787911206272856169665720981308167177143125303074466648545813452157612764258146407782634619278092168081,
        568425067761875823198893591966757461338470700675615033946429149483970138055665377562238998722395767377075284081587,
        292063178202410186631443519138674436645163233411161937085629856088259050827382985093506892763617302007759121037731,
        572237520943575841301998365238940412928982617335768155394691567092595694943290938278464533099223273214233507106207,
        130730938892686892107630262721901246969052318133502728671984157629171554435251506312878040499761922665301495030981,
        185117108148352276973404708807613996548096583954940273525781406848525491758486946236965943611210198389159091280333,
        37060990092986925132287820152354618271473589014825595897838753632315007172710154561879917551705194656825456571032,
        403396730776194870459199627544122636010870768257463359235766775533882938128146112838489577777497432203020030499998,
        390519053219213422305599109947414047895590808796368085342860468917268018310638864392199371679272174634278410878307,
        128444781947873592602609418783055715736876557725608932301613294446934930933474014020041434831899064316552264614235,
        543291373538613455155809248493830432520680330961337677793905220928838352322514565851452650441518480234729892153780,
        488514444383813071753894478409325136755661751625837651637348989332739608743318097848609715931362718450900659714726,
        345584582429475420526208382863826459005483455209655712636957752389218040279848223862500232738960994712140028026289,
        93010878843154734421543561265196548806562081923037074596459052686633775723171466088126269822057315393084026072218,
        12533412965882925987419497258660569237455714460582608620237638858642686843645624645184949324869641399446820464020,
        562770032030414047557952904910126027215456025343530350248616818594366525600180778011275466074764589844321872364272,
        128451705070871056157396910591766296038989235798264982434769256144115712608648937222298167066517556774062311420353,
        490278961434267039693706795888817653385586689501848271165345121922956317504140732421546020494675482464550410472502,
        212287543946551782522399704940695532581109453008804375002654843122502975490312129477869621998080277682674199046031,
        351228167329138957128592454766411142609836239330479331051630155591459798299725613134325016512314887321869487481161,
        364056580106158102895694571253671943571916920885795142960090311722444269241247963009814588199874030295862636577768,
        323410613174912128865174768949092780979646178505039555025194364419990442219941948707117457621400459111231556621585,
        555979459475319018276106133189578589964687373772995549423813902773304274184448885651570001083614054140692063026580,
        471645896888183848879918063770091917659270906648819201901346651975957177950753583099047587304484006413716362087065,
        595746107902898270905714635379070716651708771264047581902664532594897071557252807014533004074458867603957329534516,
        557816517693603351719661411054144374250247040672226934534604151399902780319198098821629853612396635344596388943480,
        75653615683769023911143698869320584951015514055697266638646507368530841035631560833198288977975782471517557394092,
        386729218862361591185009654369415880766336899946663823664818477204172007165198875809899277634660190797185025579614,
        393108265477944240661308455550612796769200470498502703905073280606596277788078742986164286625262059483908055127428,
        365065802583204450004435661912506592532468753723399406740663534070289404492293680764078659588454240436160849321237,
        343474792575856700080726394177083134771079426798042359193966109700850531408037245425173307797050676647933775237484,
        449270583610225180914452784540333562631570453995885992409935055758994173533991695282410200635020830187612444056607,
        152477148608000973940085532267319492932629609199964217167273279315109403426434432473053141371160594251975646390787,
        215758046810520029171417357963508549726865838830930981174495643955719506571398771447950049727234258305885220507020,
        388644732079570479249894814593945177309689613386566508292336098907992239994635374799070003303374928382563877494312,
        33174396496627497383579687586254392056231321534282758587681567913835717050445163816449882425899904436708697640574,
        293328356964375951072242072976851267186828242468018707810599907336525314670450502681522283876131924077746023996643,
        292804486280753504026674757794166015519590385505528937148184945726179320137391480944836180610675717906694042510411,
        278315915715399524055936806996907092937794467054749462150463756152176847617395557111508306851465386462011262385630,
        103884040577296119486012754822466682224025370872916939490159319500421058932999421365377738193002421767097172706341,
        111463652129659874006915288174831654634146152513640366449316440114829594116719772451443937868409442532699879776869,
        475152124260969797265060453354454799124845717445357239027249597786029156307488697633998763174770332805926500738683,
        220597335944113643138040910019263318251616203954548724660953303915089233301354511542662225751359573592406567125779,
        460838912228809947843094986154780694841314087685379351551107763714127613789323858795003275958350186756130179585099,
        140183105024444619512158726537661171898184380568070161231133567610679885584873426652521827961950911404383912561621,
        100258312363732149931656549158547430770829888011033153048299126820116382987576385251423248018523377569893042593237,
        405290867185420593972711092047858403431415058957648108848290712855486205273135789994549738296802436972506132007215,
        256955277068974586752505570703153051582682851398012077625721880852140628262494489158976679841716540706155916871083,
        598549159802958710401362839481280273681933957841944662088149512518476573000011803427513695903373248355980692446393,
        308263288681016807641714404434630877489176754884164049322636274036076916608089721011418189274379096133290778967977,
        8342859679410179631729508842147337278025979845268212054683951869690623917413242667876438120214556608223950514653,
        439895086294728342454449126955941890844828534912064877350830376651948083146591737071488196253116258629344717466258,
        91881226123407259536921548434174382841001791568169293198769940131230256611806601058471105885254628422499512141440,
        377266324363766263400630205724731218877243980277025204567255708828742612895175112462476548764041808998472515741645,
        116673062533491873681185131034931580572262852751033929144868000941380674942800523209276875356733463592351603448680,
        57238242567269156027816815706946539463493497634492900168501163766058930300567388616552782194562204025116893421410,
        589774086517371498643669747060802896861503240906569357013148621028285639980785543690656162836694887880501379427719,
        299125626128142030020988742420785075132372751191528474146303145649473683269241675130370288768899920531289674244113,
        304688395547666111898109663337992917557352968749730125549180444196974698222351897080702952045364871753888027443342,
        482739851676824100473920409347215848398789318900117561465297399614115666738614477259195415015272146741220074932513,
        223546862652113236935862556158177901803806229739994958195958127700830125319767534179348037800919714328649801362322,
        150425375689725206871177727482717625428944121456212788472446922564113718518867636855506280578641904259888006038685,
        143374483079122348274771015162872747263883105211675941440480524305910827744168931572051691220561136775398957657059,
        128633351158033453796356108560970241527889904619011394383277988372280437398843373552825146090070247278923404428730,
        249625701621261544438183108711205773478938560640571200325127252485779481701078452759513943692466279038851599018511,
        330098489762871879773681019559732262466172018773272582308614672671671001199307865518506835519360693927579848132122,
        97272570979206528424127336981516817168566955222510512261839537633559389914877185855268875504270285494647179225542,
        74718841026645027941391238796126141775030441881552798010185595153873780524478674202965665888738730228577064111032,
        59009205910055868684561742529451214311094377006520731342399475542159755492342086349692903126315766192176134558364,
        147954106872023713951463145691216475084430006306060416221364896834795769425749212897622105818492094458111589403860,
        555992830271936179812799550002813412539390844307434015514327261249472823762801208645240806724751727789206958497458,
        459223438688559571249116685914649450095540121668933258507609746609794374539448063463326591749261191192370815662117,
        571393209200912648822312183637054598815269397678580613768957089116765483865121162495918269935152288322187647411253,
        177286186824084038346767370297094817293812392957721642873053028629715330336525966361030541938870465423944241324109,
        587491267113142201933590855412985429253948652679543672927232780837039223665539177593879438262959884768626979925026,
        121073719992748558849282996502703446279240313956823650619682240860630373634948798695523514085879310433388769297911,
        326992821821879354165502695961028240084978294787383957718963930070776372845305415470613976088436935751047043512627,
        55897462658973985554837453480984923331777372313619418297379632868358904708526448610515770876401568010074036247,
        474281517111080897542557845865286041097457650249727914745876496139882777461227076272058949306156001543709356614827,
        40880447006931568560802817837347288973549001731224760995212446282117046967004745589464560120352241602331262757637,
        199377582253379978414081552664345738394226248383486423477706857549702059554694037264958719644482986837756496613246,
        67583806809325529684782118654476643411516600285151896093983454855502714712133346956141976654071062935812737453191,
        452546341988439193982297214011678766258506490290911066090290647614068455151806621409756646430532117713333419814200,
        63154079944843452528208874183624055953361990336542165468695871390964383215223885775202331596927466794955939855669,
        334551033942583568474606741839213957101383590286251155186668543235920975897931743928357631453433934808796703330473,
        437000125133660712403788025992205090698484430907657894066272071296035483375078474260228687865444802416063967634962,
        79996507523856267942889507576300340014719316733731500178081582238768493408405645914333660158893963260211116177267,
        136957270824318341027124989034235585855646981093281453761145461440890955503793684517186875995202144027265329969201,
        280204753198588906275980318398478729285287961542920285529979812275266316580102545873587416433404212703776245726478,
        537734235993878341769434982550042490365981751251428660237179942734374485415922424357453321846937022328664895920607,
        498357256878949571854248804622370932859926894994690120526235824883083753765132401863605500892090016764206939698756,
        593183658694608014094449104249771865876595121367209656250471158771632486392533730913932393504513988512194994235126,
        471525047958971655208534107052287853913949987926476676197514310320411235020283503103705707957701802098089852040455,
        515550195522086342769232739520750768345601850976320014312405876943691700378141377151414091085616391824613041356222,
        229784654767967355149909497709811119368560654037206880944035229827691011815016913131119422451043820980926353941725,
        217169654015051285238559403576147518221573574303291047729813710960725792892550445720464605476174663800328177597453,
        445865555254101127829958642102675927687168710569707725467286103803938348116926832834254624089519482737855028080263,
        83946997792088073746354410376458121354546477090285151121896293987266118404260723878401677521317330022928683440101,
        472119354862263268431251633432424976904384210603399093568806291862332048310282050100842204125396472101319620313029,
        46843467515693389983627938872598324284244171067988563260495985345821466093790361374194115630948136965603015643581,
        277302589126799360982750111603442360555051934636756171066424884732490616874962892980005637968336486277371298105284,
        37796860324947087933757452089444569583341754367174335457777874936449439863762482510080776848131952814291888228252,
        329201662631483519275850208043421059140347420462580260818216051307977255139454956805683010032538225008290753339066,
        410958260744814455637908317160979333881545314073457621559204623145344687279791103290567233048673594441768330391568,
        391184069150039601440639067557184862816991051523817132396666190555512106382919904848895224325098711230221328168893,
        341778180155955688649827271577690269253924367106359453768062062983194302766144996692233530585116870343939549344048,
        482885184891891026832543019680624112333051960746415331234199075553060933581630480706330420552017650892318225421994,
        227417029879602291913898154454350465334192275455983368980997243946371067766121862949125088496933933053493304375082,
        131891059077173823480681683274809296700667012054595015489329798567668841455882278540434006611778254351469315756836,
        103977685400575936876007245351080422734569291709540152622222483086840011211808484758839889045266405362833100572217,
        430039690420862864710328860317916251552162738538460131045295388990486621940999260820629946807283129550503791042360,
        336054039341779369078755981618338727567421739252984379060088264565052065080902800664605952509539644185937023210384,
        414650487301520195860820485747902373712957920758077572646321108690388934071745453432265035539090489903222596288408,
        589576193361941267176015154197092338077060428665767302320550323024382985851379047593411265195718688560873123744185,
        218382333622730104159935425552756841820388948639519923842495333910150980936866251625988964615764772159578862214025,
        2542356543181698813075957157401385706512468063673241076844194782908937880847391489213422972872487843717747974071,
        19012712934576590810330358701965194246607393288484627129050567402003333386833300009773236871643918870071025370112,
        261459449945270346696260426170010104493420330959761424072408598127181246567262293489464049721489266230568086023687,
        393057872763078249377870634042993942252544393136978340205701555086856991894130814830449765311294161681995357980571,
        31706670785655144489258744219717253455873175486088498446357251628824725653898017817866303775262383346847940227722,
        352845629675989592022318947558037109666715372268243939061740352176833050420783754677666411876876865226448815643420,
        579523499570692157776642365278787278074363193157128877724940050501652213832135926670258239249988403301949338255538,
        534781322034571849183222718240938369181782069830117215874801137890227720544463940037268498986061166881241864175911,
        293947547828174245724554745263997068016996177889470503383528004805559670712802640725469343616840367100443153534752,
        20256488447976344493484944853334005566670073013412177398480406734598723283264289836587474269370253077015786359305,
        475307340957345844876811923970449788514706891727480716267956523131203845997503382023500463149439850432076379159007,
        9532193777031501443256432870520743234491840911054244783623102207162388499144070592024440812057106927678514406207,
        30376455906399256126534181227692885553266283699913099449205248506625206632827693466133644861846223565145288661633,
        310323302397755654510284518631138079981439265632852684852876254116989091445393487579911757256043570018377230904180,
        407387187512823516321154849212634322952876110252179375736935664859854509488826142049903683991617538259494461983206,
        211765773488300500716796064525502573590145731868562963063378748592341237756767589777342751660513980880169703658019,
        118119996850569812443799306306875048213209686043987665925365129711742300844060014347898233682054000714610165352429,
        456288037921986114882644161559494182818651772335241262800783776696209877706906644069180867207555069937013686421247,
        321798425169971169912343295962697085577508076571119888196289113181080013814133443673221049860354996979915353284172,
        324976521789232911848337505841284978746361536915903971011255451438673522500730537005137182463678372897314198988595,
        395621759076694189110473461483468243816716472466025836871653502259071450104902960119128530517955567830675053452079,
        539300517585750216948117617165146582589224695990488749904551961039061424290129525221984586819908097960720708938354,
        29279302128607422250205549520059282069518559284219582605487413142781822276106373289432262133635053599391124926385,
        554047387889265384869858916477442181952403597250555948392949469296673941793381852004501421929101000148453680659392,
        117780825424837288494479009381221759361151487239443821133102414888864152904732196195473813006762420646998382258677,
        513764579681988270425418630365712613073908798769959690739998792846173650211508078458011456784363312999085649615413,
        421686906289957894155024887354760839265000904451245772175308131137467275202489561700021659858819873604538650489994,
        420037832423259525388141394520857134457021929872555809167052539034540217718781279113965175987358081438109891771580,
        36451605745112040602804954235939462081346791770310181663631699054048414835838956409055640948581948016033003511333,
        65866443469866248828119099994518897685990064406903627156894902667947376070679854260383038634727146436274230980496,
        27676413701492447763964945205769602759768347623741189980278225943728587187940271050634054217590942659542302722334,
        500312789935788689187812810985806111797362028998353677843819125485045576943472901976055579663665267905809820905862,
        520064354401353505774803720281331074080600746212325401527048530022713769008774050816490541356142354757805595273068,
        495854656037423684061417113244964481431602915324717605570975073575414392233479237472936965636133612283412033946051,
        91739870792230359210043046401786959190045929124141709653873699398574077579395785555200462734509728806350612588545,
        484531754577892922131892661653620989224382080321025512011181426678442547912964573223048519566085582623517825865418,
        112714684344084391078866980839255594355187885339701715768009153551270432322826715969989728340963213693095849427668,
        404429204723786534299525333122163342588586991421902466839808468487493896330979873416105908841447535426923681220957,
        92404742424217640040375362532444172359091402942418950195520660310216430170054358290537973281349284862065214755739,
        224043393969043013532511880223075809120842856165608086692928112430171548569493398551019081676395857489451126409940,
        4305919427803364191555497499680058924116536587126751817219863902878291078989381194676206640960307162723876513248]
    encrypted_flag= 45690752833299626276860565848930183308016946786375859806294346622745082512511847698896914843023558560509878243217521

    """
    public_key = [260288377891444370372615148009023640057294926547602419331406531383682223097787288755377467188515435381259752760746, 322734358011758862401399370931929863052553602421714393280581187496537763321855751120439457234561080720455397490349, 88092359256403564783665281993130133541226601877969436905267415353041909757324746080398461245281826552421872983184, 601684701300110945921036937572461050140352984401874675917155063594305583314408001377505387079690115000992094388032, 193814643850628739958152744041743058858484088269609293429408490294552345005365776962194365813796130165113184925621, 51510606914703888409341761261103125433754505248101513818740574350196563260563818621033222936301769697693287778876, 502702742677974540308798846750017003106263447846689040491266463798703222616320168069962523670400796196343460832764, 86989835783586738140883150201327374176124588410464188692884973334241681514702306716383785095564084499563152815246, 515511378187957676256419959601984383408150348796281656976955880729383340611785836962788715725367023923811376366815, 119845178983025037005174732553931706284024826223176718982111213579707091766057320315419827781508690979405126062061, 207867794910968434026003881920029657224591376925067493713968219177352819759854486838459675245909787840416982457750, 239399986603216503029402544900610984881160101923294396792665204486222975420081300661354603175384772323551980155480, 306665236132315336961576566094908486196981556971172170145299174389720334940261512384837950321772782983903454058725, 558130280550827068212352576387713811027468233905173944680355562037815257403446113128895937326412940859588204361963, 123471925832174980344066571541132411467266736109103860421447462536930482316849470378251137263190870093702164003085, 146089706629012142384661350988216882483919264673129621404831339166566056469572087759748854086023354002641923689390, 446097892684389219719742914373867457099954499449824602532333181169038249081395758983133906564840000962001976506057, 204029934276059225352901134714823317920576872465404508059719045291560482057171052793698580294637069578017200124432, 412333373143000457741307988470055504576675151299345387733692618218275177027643785881042018546460452418506341967356, 171418413940299360322712423004114364681865276057786947919043883366302567169869592290151559269290446563185553350080, 401593473337411114258578268223784182795068785564101722335215736591292301602077751376477881087346810602041717163104, 204003688543820354337113938494979311981574571424756883928855286926734578790400322291262042466654212377708831289347, 555612926496986208337317871061684502803594375654879680702581403987248292734014139717756900004905653768133795128973, 462785612281910846822645629160953231999037081137615204334672445418078665808070086646804794186256411131615189487813, 77961961618173276050791733447969083544152711482614563228085622136316525792569658878271751219358260960116292497570, 517789370221435419776588087490678991824021927945387533283088388790482913301281733115458601414668206432512998904516, 281870328340314395150658482932699114581743200279996227099530744754750289102031518563761975024621347281374162044877, 60204977937304337797770029325498234132893935850995809547662640467737007197647697381430963693698522962733473746281, 395936787836195675178388359277761575381601972138693830435288611414489963379399027975388601714741876831895709497105, 90921357930302550361827901642067284191268695594120415817202534786924330392421221829361546010764453051928814876700, 238523907687908075601117120608130752369082206676107364350347208286323115036939777325067473364465438898353765093766, 277515010021988996116595000889051160811249034599876556819610707794016612800585201793339332495839495779526504613846, 187215937497318890199135284983515062319988136636108170852591598862524363777870331888216170582220867500042557737272, 411220029331367081136918789112083235781237730079305782620378994961505282090962448446931628731751970521853108685376, 433613620456520979627974441205441942311133790647897226320388205340695256818608765746266662314499649013982035729731, 509613591091334719216567967380183602959933686617275815879939870258332674755345348802452058256788513837941126219238, 352708166022264045150842358964512080203788453464883319778517822047480718640858804837886057264514786742694419419735, 486272357335492500753956372299255798603575392697018451800774427752724312455328655650777691830508441976819499348269, 1291533249748053824342851185451970324561531056195308125673915619130780992270420765078102812914222570167615953050, 520707501920546816250915326019351261090208813534492143136485743644939372232638461802625700978801768541842624647274, 272359456788721692618768612190222453304838934916628492701462591276450281926223118982602858211688086607842351391495, 119534191144397164327417397593964021477488683311215644770010641745736480039094209273092223959694752862193314087240, 394945131470603614379767959704654538029557537489316246092982427107641617479545488843535929537498546432123287486437, 395979428475608101765230328218274625986674115712051764903732593018454264017781340199795540039285257513438842708672, 322101629493887220159199019582810892418957941946300752245249462093036697035162212557261470168522953435341905295650, 60610073299031334532969727880668989046838926047395613981473675505442500833244137863225398782029541439420403686372, 492582431835005621441922899995666806499437611069193099072247918597047415020628078410849119945608854080040163699375, 356290614124448077864884136922409291617128370298210212357882465167338600485728936925448944675136056707929560080237, 469737185578879122378016959759297464132272432425745272107998534197014940235018335349886398896979254122985841196030, 522871107234918024128768136315123497251902274681110489386594944387181296826024289163431880961506314580935567743910, 407151723612481391724375429193917289623669496278028982297086458062111012958436324350527302865535766565677711383191, 597354385774970715448797740483856119139152021834911852144490298736330354118482480147237280491305029710326837274157, 541106433608213985607913120402276000940203625086988929757276286018099336445558864548353610869729642196223750468493, 417269959280528548156948994397262973057821055108288565091113745409730174626359955737489143948177504667498654245449, 165844467199853002181647516786815801413939363188955720855463610698066730208657222822269457713666541555820608908443, 54875733171006797537647859403084623422036246809497621662400918381496284440644503330411668895858884933248328986102, 465819050441857934210906305127374377291850450707906416261994960542649394393702032587209990932960399224341143990297, 369322923825463715724411404444452360125845865658673947242361968271863944079047696087621731311243573179527276498509, 553158781749591211954659671173145767949897795287325677938373702443265138456771264711232588438786042792968904732769, 409812013938165700887519758386718364160025926340003407045361393371862966914817952304595560620453598830906305966865, 494654868138757552768371639418237489264099471894419220273147503624077564865563661914136003656825657044284503346448, 583613295252460993144403074130901622751986348055784728175987246652496523293580989652454868505577305787293683850652, 45623098408168398769971239387495928980835555721564847009059790575158770295430426790200773274288087331109699336204, 39196430635656777174378129146834600960125068266405306877726260536750371354188413207203531511343645151492477471286, 269811462520469960288594953357779332541515563494806499705455036716689694055741096626927182558039773813984145657639, 56129158162087034209035841739296133948708529713411817898928727109770418208078239244331640522507423413446203417794, 524210107239750288249530336771864024916995632570549267972428294539507299820629133801771958736839361325798918246415, 74499040113803277306263886217659673645883223840279171192334357737741618882160648968176974754905084576184804774369, 537566085689080717108870646705458338163437075433046077845999622035879463636776663759447985884960181167857417860517, 67053890181708018909161683393261532526993578729770554741021482840348299866927821016301415949708659944497709907470, 226687291544149270579995169198961617407190234578516732237756117257869929434434889879973211444301745820066870869034, 30119130560797352224094299766590747178156378314088092947830899847927767559391822485618397327733723834195435500170, 273554685078063587415670757725663508130498751998110442807136494763920302805098071555958936900406570453984774374060, 87980277743580170573607118853300224477595233902389343863665172738347967268089655736029345194767280704236057718111, 415325115863346791298232938393411393462777451386243842830553121689594926353646948497680883539360608323603975987452, 291860381996369849963997875749710331697722876276851205203280910491894467229365951220031470367159168511107680106262, 554653569462940342418063467925252548314485118886100002832290030505991378878498660088540140703141291011055029173137, 323189774384600834625013268084915768916855209746568551595158521873406091567687194674213765428238599317205811518692, 271805885895959097314720980134407607645324820417975238169874050425279962478579515969226563851125481000349196674810, 273580504244152469063405670227951980303621824057876058884978331188257821496852334599050020207990127348359965113465, 89994080154200685717636930068317931325931168723237899144166312528962957042842197915530047017893088501681215899095, 179903529806043505032581494908566846659773117049401056767669943330229935007822437549131470977810261112485254094386, 337553339737054880017288314951575451797426862530219763936855885416298554494199226261714888518914541341927073075939, 55576723594346882914517616915509260915444308762551400560217462518909289055446940809390878002725822401595827206530, 16748220768196858904499918524709172735166549515085689048938405549141121222201553686060172878474455615920723669801, 317380564633191615800168658676142557493413060315417096622564923156521630376263849705099633192226251101432134441153, 533990888376667129575141849433166253104032964155895368357797314378260092470904627861359175864364684662961150582207, 51339665999563119517609216115086272052501396280925354694804471629521639434841281422984348587180771099209184749005, 598751671521816401429095343374521592165563401213195481604556405443389323390172923217639290327197434030974530635632, 502516418942980462174586089858060912235797554801782186782319843655355616321036648106166017773986280053024012403712, 96757697084956246010025820107260538706827163135748809142998937362457169471061108292297066769079020843197361323396, 160715027762704553320571142674023737670353756130518440136900430091151963142004047232920245715827837173811719927140, 279138292123840748082780689543574043699162822819208361733228093396335579794292477744981338016264347327181324984710, 76445842054689324523514421681098261857514827631364695255959418519245612571199123499205752729124353901548286671941, 383675319414133753635121914615218464358220814208747712016103562476157464944897131756675168140846189629485664787044, 260741648290568813857849033448155840373964568801980310694295413631289231242930901519918814851819352903132884286000, 572815144956474380133620797676157654285774633299428534205241845335783095326631133195133798583360396067031309578073, 326258465939147178368353573060965288327891986807699582822092415027094204965326681853802159504539722937811913340954, 270266570242986488258809014590807152136633692716132669770748395523214017062557603428657196661342410476403164567952, 594635668324174018778140793057815156885870465660609865234586849536688338135131804764199647040009222634146148815637, 112066852946512058163194024984815176069074331367673763590415760757313750687675218022751871678411881684718198988959, 72643140251973593561700085821570131390914743121754868577502110904091989089708201436984242838820806097191225214858, 418558767829526524235103555737958351573183096833081038769308995724925326439890724874671213539641031754157727776067, 196559288823369030489094238610617412012659194878611686482089456487889879135369906410569754176462601644487717691079, 484475844260869041475828428835126624027291693283800645559775410528136122290210564467730445814182429120097372738911, 397895531572254423225385975618860549078025992059379971480526615942245245283818149065605766495091059477544617632303, 173098235745543952336517747078283517802667869630628062474315240281111485771833849083340162673485620557610425012773, 395438744730241817782361196255681827924847041028664896503460681041226871979986416514203189980456170013127549062319, 470021990867207717347003710359490169212637212255796418181420825247262094876084196634243149241752002339736588912053, 116393009019558569654503508922282193810180596603376432764270301486325221610807518426481578453602546466299515294456, 312679236344738874814229979243462639486594453393064312671149009880980836289564409215088541509970023077739205203468, 125633612607015147027292740679836345332097512816636698981581758992992116056276272361001165705597842757882238693825, 550545747650576990464265884382499274254872311986381675090751886824037811235625095205217845451891396561893492715391, 582344947379262203945082609921047126789902458640974947174265099323728700596079597139164883619347159500887293859913, 597445807393853093495564866081359122814348105478914638258595339515168987499771664924728981250079847198831836930965, 203086100710322798737771097067197649738932976573837729229038404179992238381339090779534246758253939763462200026384, 366083021996787911206272856169665720981308167177143125303074466648545813452157612764258146407782634619278092168081, 568425067761875823198893591966757461338470700675615033946429149483970138055665377562238998722395767377075284081587, 292063178202410186631443519138674436645163233411161937085629856088259050827382985093506892763617302007759121037731, 572237520943575841301998365238940412928982617335768155394691567092595694943290938278464533099223273214233507106207, 130730938892686892107630262721901246969052318133502728671984157629171554435251506312878040499761922665301495030981, 185117108148352276973404708807613996548096583954940273525781406848525491758486946236965943611210198389159091280333, 37060990092986925132287820152354618271473589014825595897838753632315007172710154561879917551705194656825456571032, 403396730776194870459199627544122636010870768257463359235766775533882938128146112838489577777497432203020030499998, 390519053219213422305599109947414047895590808796368085342860468917268018310638864392199371679272174634278410878307, 128444781947873592602609418783055715736876557725608932301613294446934930933474014020041434831899064316552264614235, 543291373538613455155809248493830432520680330961337677793905220928838352322514565851452650441518480234729892153780, 488514444383813071753894478409325136755661751625837651637348989332739608743318097848609715931362718450900659714726, 345584582429475420526208382863826459005483455209655712636957752389218040279848223862500232738960994712140028026289, 93010878843154734421543561265196548806562081923037074596459052686633775723171466088126269822057315393084026072218, 12533412965882925987419497258660569237455714460582608620237638858642686843645624645184949324869641399446820464020, 562770032030414047557952904910126027215456025343530350248616818594366525600180778011275466074764589844321872364272, 128451705070871056157396910591766296038989235798264982434769256144115712608648937222298167066517556774062311420353, 490278961434267039693706795888817653385586689501848271165345121922956317504140732421546020494675482464550410472502, 212287543946551782522399704940695532581109453008804375002654843122502975490312129477869621998080277682674199046031, 351228167329138957128592454766411142609836239330479331051630155591459798299725613134325016512314887321869487481161, 364056580106158102895694571253671943571916920885795142960090311722444269241247963009814588199874030295862636577768, 323410613174912128865174768949092780979646178505039555025194364419990442219941948707117457621400459111231556621585, 555979459475319018276106133189578589964687373772995549423813902773304274184448885651570001083614054140692063026580, 471645896888183848879918063770091917659270906648819201901346651975957177950753583099047587304484006413716362087065, 595746107902898270905714635379070716651708771264047581902664532594897071557252807014533004074458867603957329534516, 557816517693603351719661411054144374250247040672226934534604151399902780319198098821629853612396635344596388943480, 75653615683769023911143698869320584951015514055697266638646507368530841035631560833198288977975782471517557394092, 386729218862361591185009654369415880766336899946663823664818477204172007165198875809899277634660190797185025579614, 393108265477944240661308455550612796769200470498502703905073280606596277788078742986164286625262059483908055127428, 365065802583204450004435661912506592532468753723399406740663534070289404492293680764078659588454240436160849321237, 343474792575856700080726394177083134771079426798042359193966109700850531408037245425173307797050676647933775237484, 449270583610225180914452784540333562631570453995885992409935055758994173533991695282410200635020830187612444056607, 152477148608000973940085532267319492932629609199964217167273279315109403426434432473053141371160594251975646390787, 215758046810520029171417357963508549726865838830930981174495643955719506571398771447950049727234258305885220507020, 388644732079570479249894814593945177309689613386566508292336098907992239994635374799070003303374928382563877494312, 33174396496627497383579687586254392056231321534282758587681567913835717050445163816449882425899904436708697640574, 293328356964375951072242072976851267186828242468018707810599907336525314670450502681522283876131924077746023996643, 292804486280753504026674757794166015519590385505528937148184945726179320137391480944836180610675717906694042510411, 278315915715399524055936806996907092937794467054749462150463756152176847617395557111508306851465386462011262385630, 103884040577296119486012754822466682224025370872916939490159319500421058932999421365377738193002421767097172706341, 111463652129659874006915288174831654634146152513640366449316440114829594116719772451443937868409442532699879776869, 475152124260969797265060453354454799124845717445357239027249597786029156307488697633998763174770332805926500738683, 220597335944113643138040910019263318251616203954548724660953303915089233301354511542662225751359573592406567125779, 460838912228809947843094986154780694841314087685379351551107763714127613789323858795003275958350186756130179585099, 140183105024444619512158726537661171898184380568070161231133567610679885584873426652521827961950911404383912561621, 100258312363732149931656549158547430770829888011033153048299126820116382987576385251423248018523377569893042593237, 405290867185420593972711092047858403431415058957648108848290712855486205273135789994549738296802436972506132007215, 256955277068974586752505570703153051582682851398012077625721880852140628262494489158976679841716540706155916871083, 598549159802958710401362839481280273681933957841944662088149512518476573000011803427513695903373248355980692446393, 308263288681016807641714404434630877489176754884164049322636274036076916608089721011418189274379096133290778967977, 8342859679410179631729508842147337278025979845268212054683951869690623917413242667876438120214556608223950514653, 439895086294728342454449126955941890844828534912064877350830376651948083146591737071488196253116258629344717466258, 91881226123407259536921548434174382841001791568169293198769940131230256611806601058471105885254628422499512141440, 377266324363766263400630205724731218877243980277025204567255708828742612895175112462476548764041808998472515741645, 116673062533491873681185131034931580572262852751033929144868000941380674942800523209276875356733463592351603448680, 57238242567269156027816815706946539463493497634492900168501163766058930300567388616552782194562204025116893421410, 589774086517371498643669747060802896861503240906569357013148621028285639980785543690656162836694887880501379427719, 299125626128142030020988742420785075132372751191528474146303145649473683269241675130370288768899920531289674244113, 304688395547666111898109663337992917557352968749730125549180444196974698222351897080702952045364871753888027443342, 482739851676824100473920409347215848398789318900117561465297399614115666738614477259195415015272146741220074932513, 223546862652113236935862556158177901803806229739994958195958127700830125319767534179348037800919714328649801362322, 150425375689725206871177727482717625428944121456212788472446922564113718518867636855506280578641904259888006038685, 143374483079122348274771015162872747263883105211675941440480524305910827744168931572051691220561136775398957657059, 128633351158033453796356108560970241527889904619011394383277988372280437398843373552825146090070247278923404428730, 249625701621261544438183108711205773478938560640571200325127252485779481701078452759513943692466279038851599018511, 330098489762871879773681019559732262466172018773272582308614672671671001199307865518506835519360693927579848132122, 97272570979206528424127336981516817168566955222510512261839537633559389914877185855268875504270285494647179225542, 74718841026645027941391238796126141775030441881552798010185595153873780524478674202965665888738730228577064111032, 59009205910055868684561742529451214311094377006520731342399475542159755492342086349692903126315766192176134558364, 147954106872023713951463145691216475084430006306060416221364896834795769425749212897622105818492094458111589403860, 555992830271936179812799550002813412539390844307434015514327261249472823762801208645240806724751727789206958497458, 459223438688559571249116685914649450095540121668933258507609746609794374539448063463326591749261191192370815662117, 571393209200912648822312183637054598815269397678580613768957089116765483865121162495918269935152288322187647411253, 177286186824084038346767370297094817293812392957721642873053028629715330336525966361030541938870465423944241324109, 587491267113142201933590855412985429253948652679543672927232780837039223665539177593879438262959884768626979925026, 121073719992748558849282996502703446279240313956823650619682240860630373634948798695523514085879310433388769297911, 326992821821879354165502695961028240084978294787383957718963930070776372845305415470613976088436935751047043512627, 55897462658973985554837453480984923331777372313619418297379632868358904708526448610515770876401568010074036247, 474281517111080897542557845865286041097457650249727914745876496139882777461227076272058949306156001543709356614827, 40880447006931568560802817837347288973549001731224760995212446282117046967004745589464560120352241602331262757637, 199377582253379978414081552664345738394226248383486423477706857549702059554694037264958719644482986837756496613246, 67583806809325529684782118654476643411516600285151896093983454855502714712133346956141976654071062935812737453191, 452546341988439193982297214011678766258506490290911066090290647614068455151806621409756646430532117713333419814200, 63154079944843452528208874183624055953361990336542165468695871390964383215223885775202331596927466794955939855669, 334551033942583568474606741839213957101383590286251155186668543235920975897931743928357631453433934808796703330473, 437000125133660712403788025992205090698484430907657894066272071296035483375078474260228687865444802416063967634962, 79996507523856267942889507576300340014719316733731500178081582238768493408405645914333660158893963260211116177267, 136957270824318341027124989034235585855646981093281453761145461440890955503793684517186875995202144027265329969201, 280204753198588906275980318398478729285287961542920285529979812275266316580102545873587416433404212703776245726478, 537734235993878341769434982550042490365981751251428660237179942734374485415922424357453321846937022328664895920607, 498357256878949571854248804622370932859926894994690120526235824883083753765132401863605500892090016764206939698756, 593183658694608014094449104249771865876595121367209656250471158771632486392533730913932393504513988512194994235126, 471525047958971655208534107052287853913949987926476676197514310320411235020283503103705707957701802098089852040455, 515550195522086342769232739520750768345601850976320014312405876943691700378141377151414091085616391824613041356222, 229784654767967355149909497709811119368560654037206880944035229827691011815016913131119422451043820980926353941725, 217169654015051285238559403576147518221573574303291047729813710960725792892550445720464605476174663800328177597453, 445865555254101127829958642102675927687168710569707725467286103803938348116926832834254624089519482737855028080263, 83946997792088073746354410376458121354546477090285151121896293987266118404260723878401677521317330022928683440101, 472119354862263268431251633432424976904384210603399093568806291862332048310282050100842204125396472101319620313029, 46843467515693389983627938872598324284244171067988563260495985345821466093790361374194115630948136965603015643581, 277302589126799360982750111603442360555051934636756171066424884732490616874962892980005637968336486277371298105284, 37796860324947087933757452089444569583341754367174335457777874936449439863762482510080776848131952814291888228252, 329201662631483519275850208043421059140347420462580260818216051307977255139454956805683010032538225008290753339066, 410958260744814455637908317160979333881545314073457621559204623145344687279791103290567233048673594441768330391568, 391184069150039601440639067557184862816991051523817132396666190555512106382919904848895224325098711230221328168893, 341778180155955688649827271577690269253924367106359453768062062983194302766144996692233530585116870343939549344048, 482885184891891026832543019680624112333051960746415331234199075553060933581630480706330420552017650892318225421994, 227417029879602291913898154454350465334192275455983368980997243946371067766121862949125088496933933053493304375082, 131891059077173823480681683274809296700667012054595015489329798567668841455882278540434006611778254351469315756836, 103977685400575936876007245351080422734569291709540152622222483086840011211808484758839889045266405362833100572217, 430039690420862864710328860317916251552162738538460131045295388990486621940999260820629946807283129550503791042360, 336054039341779369078755981618338727567421739252984379060088264565052065080902800664605952509539644185937023210384, 414650487301520195860820485747902373712957920758077572646321108690388934071745453432265035539090489903222596288408, 589576193361941267176015154197092338077060428665767302320550323024382985851379047593411265195718688560873123744185, 218382333622730104159935425552756841820388948639519923842495333910150980936866251625988964615764772159578862214025, 2542356543181698813075957157401385706512468063673241076844194782908937880847391489213422972872487843717747974071, 19012712934576590810330358701965194246607393288484627129050567402003333386833300009773236871643918870071025370112, 261459449945270346696260426170010104493420330959761424072408598127181246567262293489464049721489266230568086023687, 393057872763078249377870634042993942252544393136978340205701555086856991894130814830449765311294161681995357980571, 31706670785655144489258744219717253455873175486088498446357251628824725653898017817866303775262383346847940227722, 352845629675989592022318947558037109666715372268243939061740352176833050420783754677666411876876865226448815643420, 579523499570692157776642365278787278074363193157128877724940050501652213832135926670258239249988403301949338255538, 534781322034571849183222718240938369181782069830117215874801137890227720544463940037268498986061166881241864175911, 293947547828174245724554745263997068016996177889470503383528004805559670712802640725469343616840367100443153534752, 20256488447976344493484944853334005566670073013412177398480406734598723283264289836587474269370253077015786359305, 475307340957345844876811923970449788514706891727480716267956523131203845997503382023500463149439850432076379159007, 9532193777031501443256432870520743234491840911054244783623102207162388499144070592024440812057106927678514406207, 30376455906399256126534181227692885553266283699913099449205248506625206632827693466133644861846223565145288661633, 310323302397755654510284518631138079981439265632852684852876254116989091445393487579911757256043570018377230904180, 407387187512823516321154849212634322952876110252179375736935664859854509488826142049903683991617538259494461983206, 211765773488300500716796064525502573590145731868562963063378748592341237756767589777342751660513980880169703658019, 118119996850569812443799306306875048213209686043987665925365129711742300844060014347898233682054000714610165352429, 456288037921986114882644161559494182818651772335241262800783776696209877706906644069180867207555069937013686421247, 321798425169971169912343295962697085577508076571119888196289113181080013814133443673221049860354996979915353284172, 324976521789232911848337505841284978746361536915903971011255451438673522500730537005137182463678372897314198988595, 395621759076694189110473461483468243816716472466025836871653502259071450104902960119128530517955567830675053452079, 539300517585750216948117617165146582589224695990488749904551961039061424290129525221984586819908097960720708938354, 29279302128607422250205549520059282069518559284219582605487413142781822276106373289432262133635053599391124926385, 554047387889265384869858916477442181952403597250555948392949469296673941793381852004501421929101000148453680659392, 117780825424837288494479009381221759361151487239443821133102414888864152904732196195473813006762420646998382258677, 513764579681988270425418630365712613073908798769959690739998792846173650211508078458011456784363312999085649615413, 421686906289957894155024887354760839265000904451245772175308131137467275202489561700021659858819873604538650489994, 420037832423259525388141394520857134457021929872555809167052539034540217718781279113965175987358081438109891771580, 36451605745112040602804954235939462081346791770310181663631699054048414835838956409055640948581948016033003511333, 65866443469866248828119099994518897685990064406903627156894902667947376070679854260383038634727146436274230980496, 27676413701492447763964945205769602759768347623741189980278225943728587187940271050634054217590942659542302722334, 500312789935788689187812810985806111797362028998353677843819125485045576943472901976055579663665267905809820905862, 520064354401353505774803720281331074080600746212325401527048530022713769008774050816490541356142354757805595273068, 495854656037423684061417113244964481431602915324717605570975073575414392233479237472936965636133612283412033946051, 91739870792230359210043046401786959190045929124141709653873699398574077579395785555200462734509728806350612588545, 484531754577892922131892661653620989224382080321025512011181426678442547912964573223048519566085582623517825865418, 112714684344084391078866980839255594355187885339701715768009153551270432322826715969989728340963213693095849427668, 404429204723786534299525333122163342588586991421902466839808468487493896330979873416105908841447535426923681220957, 92404742424217640040375362532444172359091402942418950195520660310216430170054358290537973281349284862065214755739, 224043393969043013532511880223075809120842856165608086692928112430171548569493398551019081676395857489451126409940, 4305919427803364191555497499680058924116536587126751817219863902878291078989381194676206640960307162723876513248]
    encrypted_flag = 45690752833299626276860565848930183308016946786375859806294346622745082512511847698896914843023558560509878243217521
    n = len(public_key)
    A = []
    for i in range(n):
        vec = [0 for _ in range(n + 1)]
        vec[i] = 1
        vec[-1] = public_key[i]
        A.append(vec)
    A.append([1/2 for _ in range(n)] + [encrypted_flag])
    for sol in matrix(QQ, A).LLL():
        if all([i == 1/2 or i == -1/2 for i in sol[0:-1]]):
            print('FOUND')
        else:
            continue
        decrypted = 0
        for i in range(len(sol) - 1):
            decrypted |= int(1/2 - sol[i]) << i
        print(bytes.fromhex(hex(decrypted).split('x')[1]).decode())
    """


def test12():
    """
     113 * x = 642 mod p (1)
     114 * x = 851 mod p (2)
     (2) - (1):
     x = 209 mod p
     so:
     588 * x = 665 mod p
     588 * 209 - 665 = k * p
     122227 = 919 * 19 * 7 -> p = 919
    """


def test13():
    """
    jeśli liczba ma pierwiastek to jej potęgi też (ale minus ta liczba już nie)
    p%4 == 3
    """
    p = 1007621497415251

    def exm_src():
        from random import randint

        a = 288260533169915

        FLAG = b'crypto{????????????????????}'

        def encrypt_flag(flag):
            ciphertext = []
            plaintext = ''.join([bin(i)[2:].zfill(8) for i in flag])
            for b in plaintext:
                e = randint(1, p)
                n = pow(a, e, p)
                if b == '1':
                    ciphertext.append(n)
                else:
                    n = -n % p
                    ciphertext.append(n)
            return ciphertext

        print(encrypt_flag(FLAG))
    f = [67594220461269, 501237540280788, 718316769824518, 296304224247167, 48290626940198, 30829701196032, 521453693392074,
         840985324383794, 770420008897119, 745131486581197, 729163531979577, 334563813238599, 289746215495432,
         538664937794468, 894085795317163, 983410189487558, 863330928724430, 996272871140947, 352175210511707,
         306237700811584, 631393408838583, 589243747914057, 538776819034934, 365364592128161, 454970171810424,
         986711310037393, 657756453404881, 388329936724352, 90991447679370, 714742162831112, 62293519842555,
         653941126489711, 448552658212336, 970169071154259, 339472870407614, 406225588145372, 205721593331090,
         926225022409823, 904451547059845, 789074084078342, 886420071481685, 796827329208633, 433047156347276,
         21271315846750, 719248860593631, 534059295222748, 879864647580512, 918055794962142, 635545050939893,
         319549343320339, 93008646178282, 926080110625306, 385476640825005, 483740420173050, 866208659796189,
         883359067574584, 913405110264883, 898864873510337, 208598541987988, 23412800024088, 911541450703474,
         57446699305445, 513296484586451, 180356843554043, 756391301483653, 823695939808936, 452898981558365,
         383286682802447, 381394258915860, 385482809649632, 357950424436020, 212891024562585, 906036654538589,
         706766032862393, 500658491083279, 134746243085697, 240386541491998, 850341345692155, 826490944132718,
         329513332018620, 41046816597282, 396581286424992, 488863267297267, 92023040998362, 529684488438507,
         925328511390026, 524897846090435, 413156582909097, 840524616502482, 325719016994120, 402494835113608,
         145033960690364, 43932113323388, 683561775499473, 434510534220939, 92584300328516, 763767269974656,
         289837041593468, 11468527450938, 628247946152943, 8844724571683, 813851806959975, 72001988637120, 875394575395153,
         70667866716476, 75304931994100, 226809172374264, 767059176444181, 45462007920789, 472607315695803, 325973946551448,
         64200767729194, 534886246409921, 950408390792175, 492288777130394, 226746605380806, 944479111810431,
         776057001143579, 658971626589122, 231918349590349, 699710172246548, 122457405264610, 643115611310737,
         999072890586878, 203230862786955, 348112034218733, 240143417330886, 927148962961842, 661569511006072,
         190334725550806, 763365444730995, 516228913786395, 846501182194443, 741210200995504, 511935604454925,
         687689993302203, 631038090127480, 961606522916414, 138550017953034, 932105540686829, 215285284639233,
         772628158955819, 496858298527292, 730971468815108, 896733219370353, 967083685727881, 607660822695530,
         650953466617730, 133773994258132, 623283311953090, 436380836970128, 237114930094468, 115451711811481,
         674593269112948, 140400921371770, 659335660634071, 536749311958781, 854645598266824, 303305169095255,
         91430489108219, 573739385205188, 400604977158702, 728593782212529, 807432219147040, 893541884126828,
         183964371201281, 422680633277230, 218817645778789, 313025293025224, 657253930848472, 747562211812373,
         83456701182914, 470417289614736, 641146659305859, 468130225316006, 46960547227850, 875638267674897,
         662661765336441, 186533085001285, 743250648436106, 451414956181714, 527954145201673, 922589993405001,
         242119479617901, 865476357142231, 988987578447349, 430198555146088, 477890180119931, 844464003254807,
         503374203275928, 775374254241792, 346653210679737, 789242808338116, 48503976498612, 604300186163323,
         475930096252359, 860836853339514, 994513691290102, 591343659366796, 944852018048514, 82396968629164,
         152776642436549, 916070996204621, 305574094667054, 981194179562189, 126174175810273, 55636640522694,
         44670495393401, 74724541586529, 988608465654705, 870533906709633, 374564052429787, 486493568142979,
         469485372072295, 221153171135022, 289713227465073, 952450431038075, 107298466441025, 938262809228861,
         253919870663003, 835790485199226, 655456538877798, 595464842927075, 191621819564547]

    # jeśli bit był 1 to f jest pierwiastkiem, jeśli 0 to nie
    print(p%4) # dobrze, że ==3
    decrypted = 0
    for i in range(len(f) - 1):
        decrypted |= int(1 if (ls(f[i], p) == 1) else 0)
        decrypted = decrypted << 1
    print(long_to_bytes(decrypted).decode())


def test14():
    """
    N = p*q
    c1 = (2*p + 3*q)**e1 mod N
    c2 = (5*p + 7*q)**e2 mod N

    """
    """
    p, q - pierwsze
    podnosimy na skos do potęgi:
    c12 = (2*p + 3*q)**(e1*e2) mod N
    c21 = (5*p + 7*q)**(e2*e1) mod N
    oraz
    c12 = c1**e2
    c21 = c2**e1
    rozwijając wzór skróconego mnożenia tylko pierwszy i ostatni wyraz nie zawiera iloczynu pq (a pq%N == 0). czyli:
    
    c12 = [(2*p)**(e1*e2) + (3*q)**(e1*e2)] mod N
    c21 = [(5*p)**(e2*e1) + (7*q)**(e1*e2)] mod N
    
    rugując p:
    5**e1e2 c12 - 2**e1e2 c21  = 15q ** e1e2 - 14q ** e1e2 mod N = q*e1e2 mod N = 0
    
    zatem:
    
    c12 * 5**e1e2 - c21 * 2**e1e2 mod N == 0
    więc q to NWD powyższego i N (bo N to p*q)
    """
    N = 14905562257842714057932724129575002825405393502650869767115942606408600343380327866258982402447992564988466588305174271674657844352454543958847568190372446723549627752274442789184236490768272313187410077124234699854724907039770193680822495470532218905083459730998003622926152590597710213127952141056029516116785229504645179830037937222022291571738973603920664929150436463632305664687903244972880062028301085749434688159905768052041207513149370212313943117665914802379158613359049957688563885391972151218676545972118494969247440489763431359679770422939441710783575668679693678435669541781490217731619224470152467768073
    e1 = 12886657667389660800780796462970504910193928992888518978200029826975978624718627799215564700096007849924866627154987365059524315097631111242449314835868137
    e2 = 12110586673991788415780355139635579057920926864887110308343229256046868242179445444897790171351302575188607117081580121488253540215781625598048021161675697
    c1 = 14010729418703228234352465883041270611113735889838753433295478495763409056136734155612156934673988344882629541204985909650433819205298939877837314145082403528055884752079219150739849992921393509593620449489882380176216648401057401569934043087087362272303101549800941212057354903559653373299153430753882035233354304783275982332995766778499425529570008008029401325668301144188970480975565215953953985078281395545902102245755862663621187438677596628109967066418993851632543137353041712721919291521767262678140115188735994447949166616101182806820741928292882642234238450207472914232596747755261325098225968268926580993051
    c2 = 14386997138637978860748278986945098648507142864584111124202580365103793165811666987664851210230009375267398957979494066880296418013345006977654742303441030008490816239306394492168516278328851513359596253775965916326353050138738183351643338294802012193721879700283088378587949921991198231956871429805847767716137817313612304833733918657887480468724409753522369325138502059408241232155633806496752350562284794715321835226991147547651155287812485862794935695241612676255374480132722940682140395725089329445356434489384831036205387293760789976615210310436732813848937666608611803196199865435145094486231635966885932646519

    c12 = pow(c1, e2, N)
    c21 = pow(c2, e1, N)

    D = c12 * pow(5, e1 * e2, N) - c21 * pow(2, e1 * e2, N)
    q = gcd(D, N)
    p = N // q
    print("crypto{%d,%d}" % (p, q))


def test15():

    """
    n = 27772857409875257529415990911214211975844307184430241451899407838750503024323367895540981606586709985980003435082116995888017731426634845808624796292507989171497629109450825818587383112280639037484593490692935998202437639626747133650990603333094513531505209954273004473567193235535061942991750932725808679249964667090723480397916715320876867803719301313440005075056481203859010490836599717523664197112053206745235908610484907715210436413015546671034478367679465233737115549451849810421017181842615880836253875862101545582922437858358265964489786463923280312860843031914516061327752183283528015684588796400861331354873
    e = 16
    ct = 11303174761894431146735697569489134747234975144162172162401674567273034831391936916397234068346115459134602443963604063679379285919302225719050193590179240191429612072131629779948379821039610415099784351073443218911356328815458050694493726951231241096695626477586428880220528001269746547018741237131741255022371957489462380305100634600499204435763201371188769446054925748151987175656677342779043435047048130599123081581036362712208692748034620245590448762406543804069935873123161582756799517226666835316588896306926659321054276507714414876684738121421124177324568084533020088172040422767194971217814466953837590498718
    """
    """
    Powinno być:
    p,q pierwsze
    n = pq
    fi = (p-1)(q-1)
    e względnie pierwsze z fi
    d * e == 1 mod(fi)
    pub (n, e)
    priv (n, d)
    szyfrowanie:
    ct = m**e%n
    deszyforwanie:
    m = ct**d%n
    """

    n = 27772857409875257529415990911214211975844307184430241451899407838750503024323367895540981606586709985980003435082116995888017731426634845808624796292507989171497629109450825818587383112280639037484593490692935998202437639626747133650990603333094513531505209954273004473567193235535061942991750932725808679249964667090723480397916715320876867803719301313440005075056481203859010490836599717523664197112053206745235908610484907715210436413015546671034478367679465233737115549451849810421017181842615880836253875862101545582922437858358265964489786463923280312860843031914516061327752183283528015684588796400861331354873
    ct = 11303174761894431146735697569489134747234975144162172162401674567273034831391936916397234068346115459134602443963604063679379285919302225719050193590179240191429612072131629779948379821039610415099784351073443218911356328815458050694493726951231241096695626477586428880220528001269746547018741237131741255022371957489462380305100634600499204435763201371188769446054925748151987175656677342779043435047048130599123081581036362712208692748034620245590448762406543804069935873123161582756799517226666835316588896306926659321054276507714414876684738121421124177324568084533020088172040422767194971217814466953837590498718

    """
    Skoro e = 16 = 2*4 to można 4 razy pierwiastkować
    """
    from sympy.ntheory.residue_ntheory import sqrt_mod
    # dużo szybsze niż w sage, ale kod z zakomentowaniami działa w sage (wolnoooo)
    # w sage jest wyjątek jak nie ma pierwiastka!

    
    n = 27772857409875257529415990911214211975844307184430241451899407838750503024323367895540981606586709985980003435082116995888017731426634845808624796292507989171497629109450825818587383112280639037484593490692935998202437639626747133650990603333094513531505209954273004473567193235535061942991750932725808679249964667090723480397916715320876867803719301313440005075056481203859010490836599717523664197112053206745235908610484907715210436413015546671034478367679465233737115549451849810421017181842615880836253875862101545582922437858358265964489786463923280312860843031914516061327752183283528015684588796400861331354873
    ct = 11303174761894431146735697569489134747234975144162172162401674567273034831391936916397234068346115459134602443963604063679379285919302225719050193590179240191429612072131629779948379821039610415099784351073443218911356328815458050694493726951231241096695626477586428880220528001269746547018741237131741255022371957489462380305100634600499204435763201371188769446054925748151987175656677342779043435047048130599123081581036362712208692748034620245590448762406543804069935873123161582756799517226666835316588896306926659321054276507714414876684738121421124177324568084533020088172040422767194971217814466953837590498718

    #m8 = Mod(ct, n).sqrt(all=True)
    m8 = sqrt_mod(ct, n, True)
    print(m8)
    for x in m8:
        try:
            #m4 = Mod(x, n).sqrt(all=True)
            m4 = sqrt_mod(x, n, True)
        except:
            continue
        print(m4)
        for y in m4:
            try:
                #m2 = Mod(y, n).sqrt(all=True)
                m2 = sqrt_mod(y, n, True)
            except:
                continue
            print(m2)
            for z in m2:
                try:
                    #m1 = Mod(z, n).sqrt(all=True)
                    m1 = sqrt_mod(z, n, True)
                except:
                    continue
                for zzz in m1:
                    try:
                        print(bytes.fromhex(hex(zzz)[2:]).decode())
                    except:
                        continue
        
"""
wyniki sage (trochę szybciej lokalnie...):
[1876209277290408531829279775610318190428970082481016207268064357540097243512035775781673732526982975202835623046204623691442249584410200075563601160392876951338521405776324547113823141527044491280442804730385474358915225656103037642524774022281290532043647842429820460417593717722047892067941676520685046558109318705328172047219348526208276495972215926104663340969617416448141309264122399427823135098111300264808334963118235417909543066424015154406480571480422598513998095021752269781150411795224421130311435065453643474234594190683492403130203347982361246536213794774549032994266145388909424903522934803659422334009, 25896648132584848997586711135603893785415337101949225244631343481210405780811332119759307874059727010777167812035912372196575481842224645733061195132115112220159107703674501271473559970753594546204150685962550523843522413970644096008465829310813222999461562111843184013149599517813014050923809256205123632691855348385395308350697366794668591307747085387335341734086863787410869181572477318095841062013941906480427573647366672297300893346591531516627997796199042635223117454430097540639866770047391459705942440796647902108687843667674773561359583115940919066324629237139967028333486037894618590781065861597201909020864]
[10066293619021985614145744275001279826562448601226523198103827211237743884932166694000552626031087978739771896348850556373266657590680844011882046927536810081046647717097661622791667208936554624481880730373023840167637658247485414955945285607732796640421820906208829635729434074985462235804028024160654637432644548168420128793292990041962607871229013716682569260122481862913508606910104032131664743211137896667509068276088227898030892272193149269743739665612512354490891462848622540432960804593945987725652233924500217393813342354608673264566458927831407694975007792348263509256706145782457197480568152402383558039330, 17706563790853271915270246636212932149281858583203718253795580627512759139391201201540428980555622007240231538733266439514751073835954001796742749364971179090450981392353164195795715903344084413002712760319912158034799981379261718695045317725361716891083389048064174837837759160549599707187722908565154041817320118922303351604623725278914259932490287596757435814933999340945501883926495685391999453900915310077726840334396679817179544140822397401290738702066952879246224086603227269988056377248669893110601641937601328189109095503749592699923327536091872617885835239566252552071046037501070818204020643998477773315543]
[9798722381116618056227637476565566484018606253194222755351973203508462742253522311154076194134700145275527578605535821781545038187843569198505993524407287520970070771172279404172004212310432500247465608472105231701909612623072343883942216806934904529600639676698348239426243771486521532222069409611514728756060897629936844695006373653175992634673678639333010508845045985607328371180356262460490393317997708599757357055386370808544031455931154122353547239678217006604692623467390849309525705453042722141078914816760002281629323554959490483823338710209710265138177331357093216148991708169324688688552846634664517554736, 17974135028758639473188353434648645491825700931236018696547434635242040282069845584386905412452009840704475856476581174106472693238791276610118802768100701650527558338278546414415378899970206537237127882220830766500528027003674789767048386526159609001904570277574656234140949464048540410769681523114293950493903769460786635702910341667700875169045622674106994566211435218251682119656243455063173803794055498145478551555098536906666404957084392548680931128001248227132422925984458961111491476389573158695174961045341543301293114303398775480666447753713570047722665700557422845178760475114203326996035949766196813800137]
[5370880177111772214966546989780441184730582979088758194198682681008863224482634838132300999325647948020669097872225930157677364880187170876526265706842694194817578106909197243970588941339921130887677710793075528335843046264994387999241539379961528661362926489572004938607247080065754774399781057421287427370041922231774646799000471046519617269175802256452115093380121098704284238963938166801256148574846004557731299841068446848016662269146335836458809411833017994122500323517829063121087409567809485321633279599141185122092531690838114539687787203275626675170771604097842940338370255078417038830200297871843596952086, 22401977232763485314449443921433770791113724205341483257700725157741639799840733057408680607261062037959334337209891065730340366546447674932098530585665294976680051002541628574616794170940717906596915779899860469866594593361752745651749063953132984870142283464700999534959946155469307168591969875304521251879922744858948833598916244274357250534543499056987889981676360105154726251872661550722408048537207202187504608769416460867193774143869210834575668955846447239614615225934020747299929772274806395514620596262960360460829906167520151424801999260647653637690071427816673120989381928205110976854388498529017734402787]
[133707155336421411889306987407657823691387782750625431175394153252389679328080550789263073137172912564340992728590367579804708323572982310728306699138641085703468154531798733428351933887786456051713245297094079388690616746062093049573187183364716359382354218025593597299832282017987715084510029925180603964551767250165996734205210361024457733153724288780129621535840550561094253066568716668078234729413851960531924024806179657367268083059650197486201419568082424106668229421873377157138969621534250468372797867838018492649279410989062081770301947482828608998471037916971693652955924340137443542520283778604352119898, 27639150254538836117526683923806554152152919401679616020724013685498113344995287344751718533449537073415662442353526628308213023103061863497896489593369348085794160954919027085159031178392852581432880245395841918813747022880685040601417416149729797172122855736247410876267360953517074227907240902800628075285412899840557483663711504959852410070565577024659875453520640653297916237770031000855585962382639354784703984585678728057843168329955896473548276948111382809630447320029976433263878212221081630367881077994263527090273158447369203882719484516440451703862371993997544367674796258943390572142068512622256979234975]
[7714415137987866747074806358152518716625888227680873663074779506877551278629855228569924223453622840867331183537741302167114521117352553354188998788804026087214633186651558187598063519675223044713523686538430951730538270932359635252312932179917340530328977612379304158146654268245216142512438044928697208600606248912165757495282233363016735472944072501958355186943796975428883753207070581755602763063375527935401427838095698004773520144952103726172799591741286430327893153350763123392794847863086593436432438208765177417613596373926184584834576967747135952558927838740488546461301005259539983486016411307685482244211, 20058442271887390782341184553061693259218418956749367788824628331872951745693512666971057383133087145112672251544375693720903210309282292454435797503703963084282995922799267630989319592605415992771069804154505046471899368694387498398677671153177173001176232341893700315420538967289845800479312887797111470649358418178557722902634481957860132330775228811481649888112684228430126737629529135768061434048677678809834480772389209710436916268063442944861678775938178803409222396101086687028222333979529287399821437653336368165308841484432081379655209496176144360301915193174027514866451178023988032198572385093175849110662]
Hey, if you are reading this maybe I didn't mess up my code too much. Phew. I really should play more CryptoHack before rushing to code stuff from scratch again. Here's the flag: crypto{m0dul4r_squ4r3_r00t}
[10673881512446800813221719983798855110890210541823747522840252972046945135860412947628972734034370633774013259598618490095899745522551146518943293621089309257305731350910629856013468502997046998610873269607899842622000301467288513500546364710725786752032130401884961792365096556306382866623196383670146882855508562995456292718734461855726708424432019549704105012050963619548030648055075573812469822004182718013404924818600316009198721023948040082374004246084961842473499361366541604097282382118427711534367274795560510980423812650857159138020566290548313461731340026093489798548567815659835958365412740234587630098936, 17098975897428456716194270927415356864954096642606493929059154866703557888462954947912008872552339352205990175483498505792117985904083699289681502671418679914191897758540195962573914609283592038873720221085036155580437338159458620150444238622368726779473079552388042681202096679228679076368554549055661796394456104095267187679182253465150159379287281763735900063005517584310979842781524143711194375107870488731830983791884591706011715389067506588660474121594503391263616188085308206323734799724188169301886601066541034602498625207501106826469220173374966851129503005821026262779184367623692057319176056166273701255937]

"""


def test16():
    #importy przydatne
    from Crypto.Cipher import AES
    from Crypto.Util.Padding import pad, unpad
    from hashlib import sha256
    from Crypto.Util.number import getPrime, GCD, bytes_to_long, long_to_bytes, inverse
    from random import randint
    """"
    FLAG = b'crypto{????????????????????????????????}'

    p, q = getPrime(512), getPrime(512)
    n = p * q

    # Alice side
    v = (p * randint(1, n)) % n
    k_A = randint(1, n)
    while GCD(k_A, n) != 1:
        k_A = randint(1, n)
    vka = (v * k_A) % n

    # Bob side
    k_B = randint(1, n)
    while GCD(k_B, n) != 1:
        k_B = randint(1, n)
    vkakb = (vka * k_B) % n

    # Alice side
    vkb = (vkakb * inverse(k_A, n)) % n

    # Bob side
    v_s = (vkb * inverse(k_B, n)) % n

    # Alice side
    key = sha256(long_to_bytes(v)).digest()
    cipher = AES.new(key, AES.MODE_ECB)
    m = pad(FLAG, 16)
    c = cipher.encrypt(m).hex()

    out = ""
    out += f"p, q = ({p}, {q}) \n"
    out += f"vka = {vka} \n"
    out += f"vkakb = {vkakb} \n"
    out += f"vkb = {vkb} \n"
    out += f"c = '{c}' \n"
    with open("out.txt", "w") as f:
        f.write(out)

    """


    # Dane:
    p, q = (
    10699940648196411028170713430726559470427113689721202803392638457920771439452897032229838317321639599506283870585924807089941510579727013041135771337631951,
    11956676387836512151480744979869173960415735990945471431153245263360714040288733895951317727355037104240049869019766679351362643879028085294045007143623763)
    vka = 124641741967121300068241280971408306625050636261192655845274494695382484894973990899018981438824398885984003880665335336872849819983045790478166909381968949910717906136475842568208640203811766079825364974168541198988879036997489130022151352858776555178444457677074095521488219905950926757695656018450299948207
    vkakb = 114778245184091677576134046724609868204771151111446457870524843414356897479473739627212552495413311985409829523700919603502616667323311977056345059189257932050632105761365449853358722065048852091755612586569454771946427631498462394616623706064561443106503673008210435922340001958432623802886222040403262923652
    vkb = 6568897840127713147382345832798645667110237168011335640630440006583923102503659273104899584827637961921428677335180620421654712000512310008036693022785945317428066257236409339677041133038317088022368203160674699948914222030034711433252914821805540365972835274052062305301998463475108156010447054013166491083
    c = 'fef29e5ff72f28160027959474fc462e2a9e0b2d84b1508f7bd0e270bc98fac942e1402aa12db6e6a36fb380e7b53323'

    """
    n = pq
    losowe r ale mniejsze od n
    v = rp % n
    vka = v ka % n
    vkb = c kb % n (ale liczone potem) z vkakb
    vkakb = v ka kb % n
    
    trzeba znaleźć v:
    - "podzielić" vkakb przez vka (wyjdzie kb)
    - podzielić vkb przez kb
    
    albo odwrotnie...
    
    """

    n = p * q
    ct_bytes = bytes.fromhex(c)

    # 1 opcja
    #k_B = vkakb * inverse(vka, n) % n
    #v = vkb * inverse(k_B, n) % n

    # 2 opcja
    k_A = vkakb * inverse(vkb, n) % n
    v = vka * inverse(k_A, n) % n
    key = sha256(long_to_bytes(v)).digest()
    cipher = AES.new(key, AES.MODE_ECB)
    print(unpad(cipher.decrypt(ct_bytes),16).decode()) # trzeba dopełnić "na logikę" - jednak nie trzeba, trzeba odpadignować


def test17():
    """pokonało mnie"""
    pass


def test18():
    """
    q - otrzymujemy
    g, n - wybieramy
    h - klucz publiczny
    x - klucz prywatny
    g**x = h mod n (2.2 z tej książki...)
    x = log g (h)

    wymóg:
    g**q mod n == 1
    np. jeśli g = n + 1 to w rozpisaniu mnożenia będzie tylko jeden wyraz niepodzielny przez n
    ale wtedy też zawsze otrzymamy 1 jako klucz publiczny...

    potrzebny sposób, żeby dla podnoszenia do potęgi q wychodziła 1, a dla innych nie:

    trzymając się metody g = coś z n + 1:
    (g + 1) ** n = g ** n + ... + n * q * 1**(n-1) + 1**n
    jakby n == q to wszystkie wyrazy będą podzielne przez q**2 poza ostatnim, a jak n != q to poza ostatnimi dwoma, wtedy:
    Z = (q + 1) ** x = ... ( wyrazy podzielne przez q**2) + x * q + 1
    Z mod q**2 = x * q + 1
    zatem x = (Z - 1) / q
    """
    from pwn import remote
    import json
    r = remote('socket.cryptohack.org', 13403, level='debug')
    #r = remote('socket.cryptohack.org', 13403, level='warning')

    def json_recv():
        return json.loads(r.recvline().decode())

    def json_send(hsh):
        r.sendline(json.dumps(hsh).encode())

    received = r.recvline().decode()
    print("Received:")
    print(received)
    prime_hex = received.split('"')[1]
    print(prime_hex)
    #prime = int.from_bytes(bytes.fromhex(prime_hex[2:]), 'big')
    prime = int(prime_hex[2:], 16)
    q = prime
    g = q + 1
    n = q*q
    print(pow(g, q, n))
    print(prime)
    json_send({'g': hex(g), 'n': hex(n)})
    received = r.recvline().decode()
    print("Received:")
    print(received)
    h = int(received.split('"')[1][2:], 16)
    print(h)
    x = (h - 1) // q
    json_send({'x': hex(x)})
    received = r.recvline().decode()
    print("Received:")
    print(received)


test18()

"""
"Roll your Own (18)":

DLP: 2.2 z "An Introduction to Mathematical Cryptography" (tylko opis problemu, nie znalazłem poniższej metody)

1. Dane:

Serwer:
q - l. pierwsza 512 bit
x - klucz prywatny (2, q)
Klient:
g, n - wybieramy tak, że g**q % n == 1
Serwer
h - klucz publiczny = g**x % n

x = log g (h)

2. Jak uzyskać g, n żeby g**q % n == 1?

3. Pierwszy pomysł:
- n wybieramy dowolnie
- Niech g = n + 1
- Wówczas po rozpisaniu wzoru skróconego mnożenia będzie tylko jeden wyraz niepodzielny przez n:
 g ** q % n = [(n + 1) ** q]%n = [n**q + q * n**(q-1) * 1 + ... + q * n * 1 + 1]%n = 1
- W tym przypadku jednak zawsze klucz publiczny będzie także 1
- Należy zatem znaleźć sposób, który spełnia warunek ale nie dla dowolnego q, tylko q jakoś powiązanego z n i q
- We wzorze skróconego mnożenia można zauważyć, że przedostatni wyraz zawiera iloczyn n i q (z trójkąta Pascala)
- Powyższy fakt można wykorzystać narzucając wymóg na podzielność przez potęgę q
- Powyższy warunek będzie spełniony, gdy g będzie powiązane z q (q + 1 zapewni resztę 1 i przedostatni wyraz podzielny przez q**2)

4. Drugi pomysł:
- n = q**2
- g = q + 1
- Wówczas po rozpisaniu wzoru skróconego mnożenia będzie tylko jeden wyraz niepodzielny przez n:
 g ** q % n = [(q + 1) ** q]%(q**2) = [q**q + q * q**(q-1) * 1 + ... + q * q * 1 + 1]%(q**2) = 1
- Powyższe jest spełnione dlatego, że istnieje relacja między g, n i q
- Dla innego wykładnika (klucza prywatnego) spodziewany jest inny rezultat, co da nadzieję na odnalezienie go
- Sprawdźmy:
 g ** x % n = [(q + 1) ** x]%(q**2) = [q**x + x * q**(x-1) * 1 + ... + ? * q**2 * 1 + x * q * 1 + 1]%(q**2) = 
 = [x * q + 1] % (q**2) = h
- Wygląda, że wówczas da się obliczyć klucz prywatny (x < q -> x * q + 1 < g**2):
 [x * q + 1] % (q**2) = h -> x * q = 1 = h
x = (h - 1) / q
"""
